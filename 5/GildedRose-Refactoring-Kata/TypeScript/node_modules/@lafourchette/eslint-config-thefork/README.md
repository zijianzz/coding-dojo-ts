@lafourchette/eslint-config-thefork
================

Thefork eslint configuration.

Concerns
--------

 - Provide common eslint configuration for thefork projects.

Installation
------------

```
npm install --SDE eslint prettier @lafourchette/eslint-config-thefork
```

Troubleshooting
---------------

- If eslint complains about a missing `eslint-plugin-prettier` or a `@typescript-eslint/parser` dependency after the update,
  it's most likely due to an issue with the `package-lock.json` file.

  To fix it:
    - Run `rm -rf node_modules package-lock.json && npm install`
    - Then commit the changes on the `package-lock.json` file: `git add package-lock.json && git commit`

- The rule `@typescript-eslint/no-floating-promises` can sometimes return false-positives, here's a list of cases and how to fix them:
  - Top level promises can be resolved either by using a IIFE syntax or by explicitely use `void` operator. See examples:
    ```ts
    async function myAsyncFunction() {
      ...
    }
    // This will fail
    myAsyncFunction()
    // This will succeed
    void myAsyncFunction()
    // This will succeed
    (async function() {
      await myAsyncFunction();
    })();
    ```
  - Conditional Knex query building should use `query = query.where()` instead of just `query.where()`. See examples:
    ```diff
    -const query = knex('my-table').where('column-1', 'test');
    +let query = knex('my-table').where('column-1', 'test');
     if (isWithColumn2) {
    - query.where('column-2', true); // This will fail
    + query = query.where('column-2', true); // This will succeed
     }
     const results = await query.select('column-1');
    ```

Usage
-----

Make your eslint configuration extend `@lafourchette/eslint-config-thefork`.
If you are on a `node.js` project, you can also extend `@lafourchette/eslint-config-thefork/node`.
If you are on a `TypeScript` project, you should also extend `@lafourchette/eslint-config-thefork/typescript`.
You will need for this config to set the correct `node` version in the `engines` field of your `package.json`.

TypeScript Recommended Usage
---------------------------

_Note: The prettier related configuration is optional, but recommended._

_Example project: <https://github.com/lafourchette/inventory-worker/>_

At the root of your project, add a `.npmrc` file:

```
@lafourchette:registry=https://npm.pkg.thefork.io
```

You need to install `npm install -SDE eslint prettier @lafourchette/eslint-config-thefork`

`.eslintrc.js`:

```javascript
module.exports = {
  parserOptions: {
    project: './tsconfig.json',
    tsconfigRootDir: __dirname,
    ecmaVersion: 2020, // Allows for the parsing of modern ECMAScript features
    sourceType: 'module', // Allows for the use of imports
  },
  extends: [
    '@lafourchette/eslint-config-thefork',
    '@lafourchette/eslint-config-thefork/node',
    '@lafourchette/eslint-config-thefork/typescript',
  ],
};
```

`.prettierrc.yaml`:

```yaml
trailingComma: 'all'
tabWidth: 2
semi: true
singleQuote: true
printWidth: 120
useTabs: false
bracketSpacing: true
arrowParens: always
quoteProps: as-needed
```

`package.json`:

```json
{
  /** ... **/
  "scripts": {
    /** ... **/
    "format": "eslint --fix --ext .js,.ts,.jsx,.tsx .",
    "lint": "npm run lint:tsc && npm run lint:eslint",
    "lint:tsc": "tsc --noEmit",
    "lint:eslint": "eslint --ext .js,.ts,.jsx,.tsx .",
    /** ... **/
  },
  /** ... **/
}
```

Note: You can add custom `test/.eslintrc.js` for tests for example (see <https://github.com/lafourchette/inventory-worker/>).

(Example) `test/.eslintrc.js`:

```js
module.exports = {
  rules: {
    'import/no-extraneous-dependencies': 0,
    'max-len': 0,
    'no-multi-assign': 0,
    'no-unused-expressions': 0,
    'import/first': 0, // late imports are necessary for mocking
  },
};
```
